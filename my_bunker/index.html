<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ –ë—É–Ω–∫–µ—Ä</title>
    <style>
        body { background: #000; color: white; font-family: Arial; margin: 0; padding: 20px; }
        .room { max-width: 600px; margin: 0 auto; background: #1a1a1a; padding: 20px; border-radius: 10px; }
        h1 { color: #4CAF50; text-align: center; }
        .players { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin: 20px 0; }
        .player { background: #2a2a2a; padding: 10px; border-radius: 5px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #333; color: white; border: 1px solid #444; border-radius: 5px; }
        .link { background: #222; padding: 10px; border-radius: 5px; margin: 10px 0; word-break: break-all; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const ROLES = ["üë®‚Äçüç≥ –ü–æ–≤–∞—Ä", "üëÆ –ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π", "üë®‚Äçüî¨ –£—á–µ–Ω—ã–π", "üë®‚Äçüî¨ –ë–∏–æ–ª–æ–≥", "üë®‚Äçüî¨ –§–∏–∑–∏–∫", "üèÉ –°–ø–æ—Ä—Ç—Å–º–µ–Ω"];
        let room = null;
        let myName = '';
        
        function init() {
            const params = new URLSearchParams(window.location.search);
            const roomData = params.get('r');
            
            if (roomData) {
                try {
                    room = JSON.parse(atob(roomData));
                    showRoom();
                } catch {
                    showJoin();
                }
            } else {
                showCreate();
            }
        }
        
        function showCreate() {
            document.getElementById('app').innerHTML = `
                <div class="room">
                    <h1>–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h1>
                    <input id="roomName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" value="–ò–≥—Ä–∞">
                    <input id="creatorName" placeholder="–í–∞—à–µ –∏–º—è">
                    <button onclick="createRoom()">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            `;
        }
        
        function showJoin() {
            document.getElementById('app').innerHTML = `
                <div class="room">
                    <h1>–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</h1>
                    <p>–ö–æ–º–Ω–∞—Ç–∞: ${room?.name || '?'}</p>
                    <input id="playerName" placeholder="–í–∞—à–µ –∏–º—è">
                    <button onclick="joinRoom()">–í–æ–π—Ç–∏</button>
                </div>
            `;
        }
        
        function showRoom() {
            const isCreator = myName === room.creator;
            const myRole = room.roles?.[myName] || '';
            const link = `${window.location.origin}${window.location.pathname}?r=${btoa(JSON.stringify(room))}`;
            
            document.getElementById('app').innerHTML = `
                <div class="room">
                    <h1>${room.name}</h1>
                    <p>–í—ã: ${myName} ${isCreator ? 'üëë' : ''}</p>
                    
                    <div class="link">${link.substring(0, 50)}...</div>
                    <button onclick="copyLink('${link}')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                    <button onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    
                    ${isCreator && !room.gameStarted && room.players.length >= 2 ? 
                        `<button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É (${room.players.length} –∏–≥—Ä–æ–∫–∞)</button>` : ''}
                    
                    ${myRole ? `<h2>–í–∞—à–∞ —Ä–æ–ª—å: ${myRole}</h2>` : ''}
                    
                    <h3>–ò–≥—Ä–æ–∫–∏ (${room.players.length}/6):</h3>
                    <div class="players">
                        ${room.players.map(p => `
                            <div class="player">
                                ${p} ${p === room.creator ? 'üëë' : ''}
                                ${room.gameStarted && room.roles?.[p] && (p === myName || isCreator) ? 
                                    `<br><small>${room.roles[p]}</small>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (room && myName) location.reload();
            }, 5000);
        }
        
        function createRoom() {
            const roomName = document.getElementById('roomName').value || '–ò–≥—Ä–∞';
            const creatorName = document.getElementById('creatorName').value.trim();
            
            if (!creatorName) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');
            
            room = {
                id: Date.now(),
                name: roomName,
                creator: creatorName,
                players: [creatorName],
                roles: {},
                gameStarted: false
            };
            
            myName = creatorName;
            updateURL();
        }
        
        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');
            
            if (room.players.includes(playerName)) {
                return alert('–ò–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!');
            }
            
            if (room.players.length >= 6) {
                return alert('–ö–æ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!');
            }
            
            room.players.push(playerName);
            myName = playerName;
            updateURL();
        }
        
        function startGame() {
            if (room.players.length < 2) return alert('–ù—É–∂–Ω–æ 2+ –∏–≥—Ä–æ–∫–∞!');
            
            // –†–∞–∑–¥–∞–µ–º —Ä–æ–ª–∏
            const shuffled = [...ROLES].sort(() => Math.random() - 0.5);
            room.roles = {};
            room.players.forEach((player, i) => {
                if (i < shuffled.length) {
                    room.roles[player] = shuffled[i];
                }
            });
            
            room.gameStarted = true;
            updateURL();
        }
        
        function updateURL() {
            const newURL = `${window.location.origin}${window.location.pathname}?r=${btoa(JSON.stringify(room))}`;
            window.history.pushState({}, '', newURL);
            showRoom();
        }
        
        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            });
        }
        
        // –ó–∞–ø—É—Å–∫
        window.onload = init;
        window.createRoom = createRoom;
        window.joinRoom = joinRoom;
        window.startGame = startGame;
        window.copyLink = copyLink;
    </script>
</body>
</html>